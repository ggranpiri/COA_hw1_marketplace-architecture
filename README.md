



# Архитектура маркетплейса
## Цель работы

Спроектирована архитектура маркетплейса, на которой:
- продавцы размещают товары
- покупатели оформляют заказы
- реализована персонализированная выдача
- выполняется расчёт и учёт платежей
- отправляются уведомления о статусах заказов

Бизнес-логика в рамках задания не реализуется.
Реализован один технический сервис с health-check endpoint.
## C4 Container диаграмма

Диаграмма контейнерного уровня (C4 Container):

Диаграмма отражает:
- участников системы
- основные контейнеры (сервисы)
- границы владения данными
- синхронные и асинхронные взаимодействия


### Генерация диаграммы:

```bash
docker run --rm -it \
  -v "$PWD/diagrams:/workspace" \
  structurizr/cli export \
  -workspace /workspace/c4-container.dsl \
  -format plantuml \
  -output /workspace
```

```bash
docker run --rm -it \
  -e PLANTUML_LIMIT_SIZE=32768 \
  -v "$PWD/diagrams:/workspace" \
  plantuml/plantuml \
  -tpng \
  "/workspace/structurizr-containers.puml"


```


## Домены и их ответственность

### 1. Пользователи (Identity & Access)

- регистрация пользователей
- роли (покупатель/продавец)
- профиль продавца

### 2. Каталог

- товары
- категории
- атрибуты
- управление каталогом продавцами

### 3.Персонализация / Рекомендации

- формирование персонализированной ленты
- обработка поведенческих событий
- ранжирование товаров

### 4. Заказы

- оформление заказа
- жизненный цикл статусов
- история заказов

### 5. Платежи и учёт

- инициирование оплаты
- фиксация статуса платежа
- учёт (ledger)

### 6. Уведомления

- отправка Email/SMS/push
- уведомления о статусах заказов и платежей

## Распределение доменов по сервисам

| Сервис                   | Домены              |
|--------------------------|---------------------|
| Сервис пользователей     | Пользователи        |
| Сервис каталога          | Каталог             |
| Сервис рекомендаций      | Персонализация      |
| Сервис заказов           | Заказы              |
| Сервис платежей          | Платежи             |
| Сервис уведомлений       | Уведомления         |

Логика разбиения:
- Домены изолированы по бизнес-ответственности
- Платежи выделены отдельно из-за требований к корректности
- Персонализация выделена отдельно из-за отличающейся нагрузки и алгоритмов
- Отсутствует shared database
- Каждый сервис — собственный bounded context

## Границы владения данными

Каждый сервис владеет своей базой данных.

| Сервис                   | Владение данными                     |
|--------------------------|--------------------------------------|
| User Service             | пользователи, роли                  |
| Catalog Service          | товары, категории                   |
| Order Service            | заказы, статусы                     |
| Payment Service          | платежи, ledger                     |
| Recommendation Service   | агрегаты поведения пользователей     |
| Notification Service     | шаблоны и логи уведомлений          |

Shared database отсутствует.

## Взаимодействие сервисов

1. Синхронные взаимодействия
   - Frontend → API Gateway → сервисы
   - Order Service → Payment Service

2. Асинхронные взаимодействия

    Через Event Bus:
   - OrderCreated
   - OrderStatusChanged
   - PaymentAuthorized
   - PaymentFailed

Notification и Recommendation подписываются на события.

## Альтернативные варианты архитектуры

1. **Монолит**

    Один сервис + одна база данных.
    
    Плюсы:
    - простота разработки
    - простота деплоя
    - простота транзакций
    
    Минусы:
    - сложность масштабирования
    - сильная связанность
    - сложность эволюции

    **Trade-off:**
    Простота старта против гибкости и масштабируемости.


2. **Микросервисы (выбранный вариант)**

    Каждый домен — отдельный сервис.
    
    Плюсы:
    - независимое масштабирование
    - изоляция отказов
    - явные границы владения данными
    
    Минусы:
    - операционная сложность
    - распределённые транзакции
    - требования к наблюдаемости

    **Trade-off:**
    Операционная сложность против гибкости и масштабируемости.


## Обоснование выбранного варианта

Выбран вариант с микросервисной декомпозицией, поскольку:
- требуется персонализированная выдача (отдельная нагрузка)
- платежи требуют строгой изоляции
- отсутствует shared database
- требуется масштабирование различных частей системы независимо

Данный вариант лучше соответствует архитектуре растущей платформы.


# Запуск сервиса

Сервис реализован на FastAPI.

```bash
cd service
docker compose up --build
curl -i http://localhost:8080/health
```
Ожидаемый результат:
HTTP/1.1 200 OK
